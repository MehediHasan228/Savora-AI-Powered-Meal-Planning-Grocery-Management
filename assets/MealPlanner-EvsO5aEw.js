import{r as c,m as M,j as e,X as E,o as q,p as z,F as P,q as H,s as d,i as U,R as C,t as X,v as $,w as B,x as J,h as K,P as Q}from"./index-BV9WeYqX.js";const V=({isOpen:m,onClose:g,onSelect:w})=>{const[y,b]=c.useState([]),[p,f]=c.useState(""),[x,h]=c.useState(!1);c.useEffect(()=>{m&&j()},[m]);const j=async()=>{h(!0);try{const r=await M.getAll();b(r.data)}catch(r){console.error("Failed to fetch recipes:",r)}finally{h(!1)}},i=y.filter(r=>r.title.toLowerCase().includes(p.toLowerCase()));return m?e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Select a Recipe"}),e.jsx("button",{onClick:g,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(E,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-4 border-b border-gray-100",children:e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search your recipes...",value:p,onChange:r=>f(r.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-primary",autoFocus:!0})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:x?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading recipes..."}):Array.isArray(i)&&i.length>0?i.map(r=>e.jsxs("div",{onClick:()=>w(r),className:"flex items-center gap-4 p-3 border border-gray-100 rounded-lg hover:border-primary/50 hover:bg-primary/5 cursor-pointer transition-all group",children:[e.jsx("img",{src:r.image||"https://images.unsplash.com/photo-1495521841625-27a630a5f7a9?w=150&q=80",alt:r.title,className:"w-16 h-16 rounded-md object-cover bg-gray-100"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-gray-800 group-hover:text-primary transition-colors",children:r.title}),r.matchPercentage&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full font-bold ${r.matchPercentage>=90?"bg-emerald-100 text-emerald-700":r.matchPercentage>=80?"bg-green-100 text-green-700":r.matchPercentage>=70?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600"}`,children:[r.matchPercentage>=90?"ðŸ”¥":"âœ¨"," ",r.matchPercentage,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"w-3 h-3 mr-1"}),r.time," min"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),r.calories," kcal"]}),r.cuisine&&e.jsx("span",{className:"bg-gray-100 px-2 py-0.5 rounded-full",children:r.cuisine})]})]})]},r.id)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:['No recipes found matching "',p,'"']})})]})}):null},_=()=>{const m=H(),[g,w]=c.useState(new Date),[y,b]=c.useState([]),[p,f]=c.useState(!0),[x,h]=c.useState(!1),[j,i]=c.useState(!1),[r,A]=c.useState(null),l=(a=>{const t=new Date(a),n=t.getDay(),s=t.getDate()-n+(n===0?-6:1);return new Date(t.setDate(s))})(g),N=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],S=["breakfast","lunch","dinner"];c.useEffect(()=>{u()},[g]);const u=async()=>{f(!0);try{const a=l.toISOString(),t=new Date(l);t.setDate(t.getDate()+6);const n=t.toISOString(),s=await d.getWeekPlan(a,n);b(Array.isArray(s.data)?s.data:[])}catch(a){console.error("Failed to fetch plan:",a)}finally{f(!1)}},I=async()=>{if(window.confirm("Generate a new meal plan for this week? This will overwrite existing empty slots.")){h(!0);try{await d.generateWeekPlan(l.toISOString()),await u()}catch(a){alert("Failed to generate plan: "+(a.response?.data?.message||a.message))}finally{h(!1)}}},D=a=>{const t=new Date(g);t.setDate(t.getDate()+a*7),w(t)},R=async()=>{if(window.confirm("Add all ingredients from this week's plan to your Grocery List?"))try{const a=l.toISOString(),t=new Date(l);t.setDate(t.getDate()+6);const n=t.toISOString(),s=await d.addToGrocery(a,n);alert(s.data.message)}catch(a){alert("Failed to sync to grocery: "+(a.response?.data?.message||a.message))}},F=(a,t)=>{const n=new Date(l);n.setDate(n.getDate()+a),A({date:n,slot:t}),i(!0)},O=async a=>{if(r)try{await d.updateSlot({date:r.date.toISOString(),slot:r.slot,recipeId:a.id}),i(!1),u()}catch(t){alert("Failed to update slot"),console.error(t)}},L=async(a,t,n)=>{if(a.stopPropagation(),!window.confirm("Clear this meal?"))return;const s=new Date(l);s.setDate(s.getDate()+t);try{await d.deleteSlot(s.toISOString(),n),u()}catch{alert("Failed to clear slot")}},k=async(a,t,n,s,o)=>{a.stopPropagation();const G=Math.max(1,s+o),v=new Date(l);v.setDate(v.getDate()+t);try{await d.updateSlot({date:v.toISOString(),slot:n,servings:G}),u()}catch(T){console.error(T)}},W=(a,t)=>{const n=new Date(l);return n.setDate(n.getDate()+a),Array.isArray(y)?y.find(s=>{const o=new Date(s.date);return o.getDate()===n.getDate()&&o.getMonth()===n.getMonth()&&s.slot===t}):void 0};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Smart Meal Planner"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Automated weekly meal schedules based on your preferences"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:R,className:"bg-emerald-600 text-white px-5 py-2.5 rounded-lg font-medium shadow-sm hover:bg-emerald-700 transition-colors flex items-center",children:[e.jsx(U,{className:"w-5 h-5 mr-2"}),"Add Week to Grocery"]}),e.jsxs("button",{onClick:I,disabled:x,className:"bg-primary text-white px-5 py-2.5 rounded-lg font-medium shadow-sm hover:bg-emerald-600 transition-colors flex items-center disabled:opacity-70",children:[x?e.jsx(C,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(C,{className:"w-5 h-5 mr-2"}),x?"Generating...":"Auto-Generate Week"]}),e.jsxs("button",{onClick:()=>m("/settings"),className:"bg-white text-gray-700 border border-gray-200 px-4 py-2.5 rounded-lg font-medium hover:bg-gray-50 transition-colors flex items-center",children:[e.jsx(X,{className:"w-5 h-5 mr-2"}),"Preferences"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-white p-4 rounded-xl shadow-sm border border-gray-100",children:[e.jsx("button",{onClick:()=>D(-1),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx($,{})}),e.jsxs("div",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-primary"}),e.jsxs("span",{children:[l.toLocaleDateString(void 0,{month:"long",day:"numeric"})," - ",new Date(new Date(l).setDate(l.getDate()+6)).toLocaleDateString(void 0,{month:"long",day:"numeric"})]})]}),e.jsx("button",{onClick:()=>D(1),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(J,{})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-4 overflow-x-auto pb-4 min-w-[1000px]",children:Array.isArray(N)&&N.map((a,t)=>e.jsxs("div",{className:"flex flex-col gap-3 min-w-[140px]",children:[e.jsxs("div",{className:"text-center font-semibold text-gray-700 bg-gray-50 py-2 rounded-lg border border-gray-100",children:[a," ",e.jsx("br",{}),e.jsx("span",{className:"text-xs font-normal text-gray-500",children:new Date(new Date(l).setDate(l.getDate()+t)).getDate()})]}),Array.isArray(S)&&S.map(n=>{const s=W(t,n);return e.jsxs("div",{onClick:()=>F(t,n),className:"flex-1 bg-white border border-gray-100 rounded-xl p-3 shadow-sm min-h-[120px] relative hover:shadow-md transition-shadow group cursor-pointer",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-gray-400",children:n}),s&&e.jsx("button",{onClick:o=>L(o,t,n),className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-red-50 text-gray-400 hover:text-red-500 rounded transition-all",title:"Remove",children:e.jsx(K,{className:"w-3.5 h-3.5"})})]}),s?e.jsx("div",{className:"space-y-2",children:s.recipe?e.jsxs(e.Fragment,{children:[s.recipe.image&&e.jsx("img",{src:s.recipe.image,alt:s.recipe.title,className:"w-full h-24 object-cover rounded-lg mb-2"}),e.jsx("div",{className:"text-sm font-medium text-gray-800 line-clamp-2",children:s.recipe.title}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(P,{className:"w-3 h-3"}),s.recipe.calories*(s.servings||1)," kcal"]}),e.jsxs("div",{className:"flex items-center bg-gray-50 rounded-lg p-0.5",onClick:o=>o.stopPropagation(),children:[e.jsx("button",{onClick:o=>k(o,t,n,s.servings||1,-1),className:"p-1 hover:bg-gray-200 rounded text-gray-600 w-5 h-5 flex items-center justify-center text-xs",children:"-"}),e.jsx("span",{className:"text-xs font-semibold px-1.5 text-gray-700",children:s.servings||1}),e.jsx("button",{onClick:o=>k(o,t,n,s.servings||1,1),className:"p-1 hover:bg-gray-200 rounded text-gray-600 w-5 h-5 flex items-center justify-center text-xs",children:"+"})]})]})]}):e.jsx("div",{className:"text-sm italic text-gray-500",children:"Custom Item"})}):e.jsx("div",{className:"h-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("div",{className:"p-2 bg-gray-50 rounded-full hover:bg-gray-100 text-gray-400",children:e.jsx(Q,{className:"w-4 h-4"})})})]},n)})]},a))}),e.jsx(V,{isOpen:j,onClose:()=>i(!1),onSelect:O})]})};export{_ as default};
