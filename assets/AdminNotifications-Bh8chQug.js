import{c as A,r,n as u,j as e,A as C,y,z as p,D as E,U as k}from"./index-DYg-nYXC.js";import{C as b}from"./chart-column-BVCPcngV.js";const T=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],I=A("shield-alert",T),V=()=>{const[l,f]=r.useState(null),[i,m]=r.useState("ACTIVE"),[L,j]=r.useState(!0),[t,n]=r.useState({title:"",message:"",segment:"ALL",dietPreference:"",activityLink:""}),[x,h]=r.useState(!1),[d,c]=r.useState(null);r.useEffect(()=>{g(),N()},[]);const N=async()=>{try{const s=localStorage.getItem("token"),a=await fetch("https://savora-backend-213l.onrender.com/api/admin/notifications/stats",{headers:{Authorization:`Bearer ${s}`}})}catch(s){console.error(s)}},g=async()=>{try{const s=await u.getStats();f(s.data),m(s.data.systemStatus||"ACTIVE")}catch(s){console.error("Failed to fetch stats:",s)}finally{j(!1)}},v=async s=>{s.preventDefault(),h(!0),c(null);try{const a=await u.sendBroadcast(t);c({type:"success",message:`Broadcast sent successfully! Target: ${a.data.results.sent} users.`}),n({title:"",message:"",segment:"ALL",dietPreference:"",activityLink:""}),g()}catch{c({type:"error",message:"Failed to send broadcast."})}finally{h(!1)}},w=async()=>{const s=i==="ACTIVE"?"PAUSED":"ACTIVE";if(window.confirm(`${s==="PAUSED"?"HALT":"RESUME"} ALL NOTIFICATIONS?`))try{const a=localStorage.getItem("token"),S=await(await fetch("https://savora-backend-213l.onrender.com/api/admin/notifications/emergency-stop",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({status:s})})).json();m(s),alert(S.message)}catch(a){console.error(a),alert("Action failed.")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Notification Command Center"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Manage broadcasts, segments, and system-wide alerts"})]}),e.jsxs("button",{onClick:w,className:`flex items-center gap-2 px-4 py-2 rounded-lg font-bold transition-all shadow-sm border ${i==="ACTIVE"?"bg-red-50 text-red-600 border-red-100 hover:bg-red-100":"bg-emerald-50 text-emerald-600 border-emerald-100 hover:bg-emerald-100"}`,children:[e.jsx(I,{className:"w-5 h-5"}),i==="ACTIVE"?"EMERGENCY STOP":"RESUME SYSTEM"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 text-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(C,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400 font-medium",children:"Total Sent"}),e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:l?.total||0})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-emerald-50 text-emerald-600 rounded-xl flex items-center justify-center",children:e.jsx(y,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400 font-medium",children:"Read Rate"}),e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:l?.readRate||"0%"})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-amber-50 text-amber-600 rounded-xl flex items-center justify-center",children:e.jsx(b,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400 font-medium",children:"Active Campaigns"}),e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:l?.typeStats?.length||0})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 bg-gray-50/50 flex items-center gap-2",children:[e.jsx(p,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"font-bold text-gray-800",children:"Compose Broadcast"})]}),e.jsxs("form",{onSubmit:v,className:"p-6 space-y-4",children:[d&&e.jsxs("div",{className:`p-4 rounded-xl flex items-center gap-3 ${d.type==="success"?"bg-emerald-50 text-emerald-700":"bg-red-50 text-red-700"}`,children:[d.type==="success"?e.jsx(y,{className:"w-5 h-5"}):e.jsx(E,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:d.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Target Segment"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["ALL","DIET","INACTIVE"].map(s=>e.jsx("button",{type:"button",onClick:()=>n({...t,segment:s}),className:`py-2 text-xs font-bold rounded-lg border transition-all ${t.segment===s?"bg-primary text-white border-primary shadow-sm":"bg-white text-gray-500 border-gray-200 hover:bg-gray-50"}`,children:s},s))})]}),t.segment==="DIET"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cuisine Preference"}),e.jsxs("select",{className:"w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-primary",value:t.dietPreference,onChange:s=>n({...t,dietPreference:s.target.value}),children:[e.jsx("option",{value:"",children:"Select Cuisine..."}),e.jsx("option",{value:"Italian",children:"Italian"}),e.jsx("option",{value:"Asian",children:"Asian"}),e.jsx("option",{value:"Mexican",children:"Mexican"}),e.jsx("option",{value:"Vegan",children:"Vegan"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),e.jsx("input",{required:!0,type:"text",className:"w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-primary",placeholder:"e.g., Happy Lunar New Year! ðŸ‰",value:t.title,onChange:s=>n({...t,title:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Message Body"}),e.jsx("textarea",{required:!0,rows:"4",className:"w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-primary text-sm",placeholder:"What would you like to say to your users?",value:t.message,onChange:s=>n({...t,message:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Activity Link (Optional)"}),e.jsx("input",{type:"text",className:"w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-primary",placeholder:"/recipes or /inventory",value:t.activityLink,onChange:s=>n({...t,activityLink:s.target.value})})]}),e.jsx("button",{disabled:x,type:"submit",className:"w-full py-3 bg-primary text-white rounded-xl font-bold hover:bg-emerald-600 transition-all shadow-lg flex items-center justify-center gap-2 disabled:opacity-50",children:x?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-5 h-5"}),"SEND BROADCAST"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 bg-gray-50/50 flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"font-bold text-gray-800",children:"Notification Volume by Type"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"space-y-4",children:[l?.typeStats?.map((s,a)=>{const o=(s._count._all/l.total*100).toFixed(0);return e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between text-xs font-bold uppercase tracking-wider",children:[e.jsx("span",{className:"text-gray-500",children:s.type}),e.jsxs("span",{className:"text-gray-900",children:[s._count._all," (",o,"%)"]})]}),e.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${s.type==="EXPIRY"?"bg-red-500":s.type==="GROCERY"?"bg-blue-500":s.type==="MEAL"?"bg-emerald-500":"bg-purple-500"}`,style:{width:`${o}%`}})})]},a)}),!l?.typeStats?.length&&e.jsx("div",{className:"text-center py-10",children:e.jsx("p",{className:"text-gray-400 text-sm",children:"No data available yet"})})]}),e.jsx("div",{className:"mt-8 p-4 bg-primary/5 rounded-xl border border-primary/10",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(k,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-gray-800",children:"Audience Reach"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'Based on current segments, a broadcast to "ALL" will reach approximately 100% of your active user base.'})]})]})})]})]})]})]})};export{V as default};
