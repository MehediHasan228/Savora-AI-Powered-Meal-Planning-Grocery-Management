import{r as c,m as A,j as e,X as E,o as q,p as z,F as k,q as H,s as d,i as U,R as D,t as X,v as $,w as B,x as J,h as K,P as Q}from"./index-Cimb5RMA.js";const V=({isOpen:m,onClose:g,onSelect:f})=>{const[w,b]=c.useState([]),[p,y]=c.useState(""),[x,h]=c.useState(!1);c.useEffect(()=>{m&&j()},[m]);const j=async()=>{h(!0);try{const a=await A.getAll();b(a.data)}catch(a){console.error("Failed to fetch recipes:",a)}finally{h(!1)}},i=w.filter(a=>a.title.toLowerCase().includes(p.toLowerCase()));return m?e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Select a Recipe"}),e.jsx("button",{onClick:g,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(E,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-4 border-b border-gray-100",children:e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search your recipes...",value:p,onChange:a=>y(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:border-primary",autoFocus:!0})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:x?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading recipes..."}):i.length>0?i.map(a=>e.jsxs("div",{onClick:()=>f(a),className:"flex items-center gap-4 p-3 border border-gray-100 rounded-lg hover:border-primary/50 hover:bg-primary/5 cursor-pointer transition-all group",children:[e.jsx("img",{src:a.image||"https://images.unsplash.com/photo-1495521841625-27a630a5f7a9?w=150&q=80",alt:a.title,className:"w-16 h-16 rounded-md object-cover bg-gray-100"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-gray-800 group-hover:text-primary transition-colors",children:a.title}),a.matchPercentage&&e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded-full font-bold ${a.matchPercentage>=90?"bg-emerald-100 text-emerald-700":a.matchPercentage>=80?"bg-green-100 text-green-700":a.matchPercentage>=70?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600"}`,children:[a.matchPercentage>=90?"ðŸ”¥":"âœ¨"," ",a.matchPercentage,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"w-3 h-3 mr-1"}),a.time," min"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"w-3 h-3 mr-1"}),a.calories," kcal"]}),a.cuisine&&e.jsx("span",{className:"bg-gray-100 px-2 py-0.5 rounded-full",children:a.cuisine})]})]})]},a.id)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:['No recipes found matching "',p,'"']})})]})}):null},_=()=>{const m=H(),[g,f]=c.useState(new Date),[w,b]=c.useState([]),[p,y]=c.useState(!0),[x,h]=c.useState(!1),[j,i]=c.useState(!1),[a,C]=c.useState(null),l=(s=>{const t=new Date(s),r=t.getDay(),n=t.getDate()-r+(r===0?-6:1);return new Date(t.setDate(n))})(g),P=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],I=["breakfast","lunch","dinner"];c.useEffect(()=>{u()},[g]);const u=async()=>{y(!0);try{const s=l.toISOString(),t=new Date(l);t.setDate(t.getDate()+6);const r=t.toISOString(),n=await d.getWeekPlan(s,r);b(n.data)}catch(s){console.error("Failed to fetch plan:",s)}finally{y(!1)}},R=async()=>{if(window.confirm("Generate a new meal plan for this week? This will overwrite existing empty slots.")){h(!0);try{await d.generateWeekPlan(l.toISOString()),await u()}catch(s){alert("Failed to generate plan: "+(s.response?.data?.message||s.message))}finally{h(!1)}}},N=s=>{const t=new Date(g);t.setDate(t.getDate()+s*7),f(t)},F=async()=>{if(window.confirm("Add all ingredients from this week's plan to your Grocery List?"))try{const s=l.toISOString(),t=new Date(l);t.setDate(t.getDate()+6);const r=t.toISOString(),n=await d.addToGrocery(s,r);alert(n.data.message)}catch(s){alert("Failed to sync to grocery: "+(s.response?.data?.message||s.message))}},O=(s,t)=>{const r=new Date(l);r.setDate(r.getDate()+s),C({date:r,slot:t}),i(!0)},L=async s=>{if(a)try{await d.updateSlot({date:a.date.toISOString(),slot:a.slot,recipeId:s.id}),i(!1),u()}catch(t){alert("Failed to update slot"),console.error(t)}},W=async(s,t,r)=>{if(s.stopPropagation(),!window.confirm("Clear this meal?"))return;const n=new Date(l);n.setDate(n.getDate()+t);try{await d.deleteSlot(n.toISOString(),r),u()}catch{alert("Failed to clear slot")}},S=async(s,t,r,n,o)=>{s.stopPropagation();const T=Math.max(1,n+o),v=new Date(l);v.setDate(v.getDate()+t);try{await d.updateSlot({date:v.toISOString(),slot:r,servings:T}),u()}catch(M){console.error(M)}},G=(s,t)=>{const r=new Date(l);return r.setDate(r.getDate()+s),w.find(n=>{const o=new Date(n.date);return o.getDate()===r.getDate()&&o.getMonth()===r.getMonth()&&n.slot===t})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Smart Meal Planner"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Automated weekly meal schedules based on your preferences"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:F,className:"bg-emerald-600 text-white px-5 py-2.5 rounded-lg font-medium shadow-sm hover:bg-emerald-700 transition-colors flex items-center",children:[e.jsx(U,{className:"w-5 h-5 mr-2"}),"Add Week to Grocery"]}),e.jsxs("button",{onClick:R,disabled:x,className:"bg-primary text-white px-5 py-2.5 rounded-lg font-medium shadow-sm hover:bg-emerald-600 transition-colors flex items-center disabled:opacity-70",children:[x?e.jsx(D,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(D,{className:"w-5 h-5 mr-2"}),x?"Generating...":"Auto-Generate Week"]}),e.jsxs("button",{onClick:()=>m("/settings"),className:"bg-white text-gray-700 border border-gray-200 px-4 py-2.5 rounded-lg font-medium hover:bg-gray-50 transition-colors flex items-center",children:[e.jsx(X,{className:"w-5 h-5 mr-2"}),"Preferences"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-white p-4 rounded-xl shadow-sm border border-gray-100",children:[e.jsx("button",{onClick:()=>N(-1),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx($,{})}),e.jsxs("div",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-primary"}),e.jsxs("span",{children:[l.toLocaleDateString(void 0,{month:"long",day:"numeric"})," - ",new Date(new Date(l).setDate(l.getDate()+6)).toLocaleDateString(void 0,{month:"long",day:"numeric"})]})]}),e.jsx("button",{onClick:()=>N(1),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(J,{})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-4 overflow-x-auto pb-4 min-w-[1000px]",children:P.map((s,t)=>e.jsxs("div",{className:"flex flex-col gap-3 min-w-[140px]",children:[e.jsxs("div",{className:"text-center font-semibold text-gray-700 bg-gray-50 py-2 rounded-lg border border-gray-100",children:[s," ",e.jsx("br",{}),e.jsx("span",{className:"text-xs font-normal text-gray-500",children:new Date(new Date(l).setDate(l.getDate()+t)).getDate()})]}),I.map(r=>{const n=G(t,r);return e.jsxs("div",{onClick:()=>O(t,r),className:"flex-1 bg-white border border-gray-100 rounded-xl p-3 shadow-sm min-h-[120px] relative hover:shadow-md transition-shadow group cursor-pointer",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-gray-400",children:r}),n&&e.jsx("button",{onClick:o=>W(o,t,r),className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-red-50 text-gray-400 hover:text-red-500 rounded transition-all",title:"Remove",children:e.jsx(K,{className:"w-3.5 h-3.5"})})]}),n?e.jsx("div",{className:"space-y-2",children:n.recipe?e.jsxs(e.Fragment,{children:[n.recipe.image&&e.jsx("img",{src:n.recipe.image,alt:n.recipe.title,className:"w-full h-24 object-cover rounded-lg mb-2"}),e.jsx("div",{className:"text-sm font-medium text-gray-800 line-clamp-2",children:n.recipe.title}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(k,{className:"w-3 h-3"}),n.recipe.calories*(n.servings||1)," kcal"]}),e.jsxs("div",{className:"flex items-center bg-gray-50 rounded-lg p-0.5",onClick:o=>o.stopPropagation(),children:[e.jsx("button",{onClick:o=>S(o,t,r,n.servings||1,-1),className:"p-1 hover:bg-gray-200 rounded text-gray-600 w-5 h-5 flex items-center justify-center text-xs",children:"-"}),e.jsx("span",{className:"text-xs font-semibold px-1.5 text-gray-700",children:n.servings||1}),e.jsx("button",{onClick:o=>S(o,t,r,n.servings||1,1),className:"p-1 hover:bg-gray-200 rounded text-gray-600 w-5 h-5 flex items-center justify-center text-xs",children:"+"})]})]})]}):e.jsx("div",{className:"text-sm italic text-gray-500",children:"Custom Item"})}):e.jsx("div",{className:"h-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("div",{className:"p-2 bg-gray-50 rounded-full hover:bg-gray-100 text-gray-400",children:e.jsx(Q,{className:"w-4 h-4"})})})]},r)})]},s))}),e.jsx(V,{isOpen:j,onClose:()=>i(!1),onSelect:L})]})};export{_ as default};
