import{c as j,u as J,r as i,g as c,j as e,R as Q,P as X,Z as ee,X as W,L as te,T as se,a as ae,b as re,d as le,C as ne,e as oe,f as ie,h as ce}from"./index-nqbfFPuq.js";import{A as de}from"./arrow-right-BgPcxw-s.js";const xe=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],me=j("archive",xe);const ue=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],ge=j("chart-pie",ue);const he=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],pe=j("pencil",he);const ye=[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]],T=j("shopping-bag",ye),B=["Produce","Bakery","Dairy & Alternatives","Meat & Poultry","Seafood","Pasta & Grains","Canned & Jarred","Condiments","Spices & Seasonings","Baking","Snacks","Frozen","Beverages","Coffee & Tea","Cleaning","Personal Care","Home & Kitchen","General","Other"],je=()=>{const{inventory:h,refreshInventory:v}=J(),[o,d]=i.useState([]),[N,p]=i.useState(!0),[x,a]=i.useState(!1),[m,y]=i.useState(!1),[z,F]=i.useState(!1),[r,n]=i.useState({name:"",category:"Produce",price:"",qty:1,unit:"pcs",buyStatus:"NOW"}),[b,w]=i.useState(null),[G,A]=i.useState(!1),[L,u]=i.useState(null);i.useEffect(()=>{k()},[]);const k=async()=>{p(!0);try{const t=await c.getAll();d(t.data)}catch(t){console.error("Failed to fetch grocery items:",t)}finally{p(!1)}},D=async()=>{if(window.confirm("Move all bought items to your Inventory?"))try{const t=await c.moveToInventory();console.log("Move response:",t.data),t.data.count>0?(alert(`Successfully moved ${t.data.count} items to Inventory!`),k(),v()):alert(`No bought items found to move. 
(Make sure items are checked off!)`)}catch(t){console.error("Failed to move items:",t);const s=t.response?.data?.message||t.message||"Unknown error";alert(`Failed to move items: ${s}`)}},O=async t=>{try{await c.toggle(t),d(s=>s.map(l=>l.id===t?{...l,isBought:!l.isBought}:l))}catch(s){console.error("Failed to toggle item:",s)}},$=async t=>{try{await c.togglePriority(t),d(s=>s.map(l=>l.id===t?{...l,buyStatus:l.buyStatus==="NOW"?"LATER":"NOW"}:l))}catch(s){console.error("Failed to toggle buy status:",s)}},U=async()=>{a(!0);try{const t=await c.refresh();d(t.data)}catch(t){console.error("Failed to refresh intelligence:",t)}finally{a(!1)}},V=async()=>{if(window.confirm("Clear all bought items?"))try{await c.clearCompleted(),d(o.filter(t=>!t.isBought))}catch(t){console.error("Failed to clear completed items:",t)}},Z=async t=>{if(t.preventDefault(),!!r.name)try{if(b)await c.update(b,{...r,price:parseFloat(r.price)||0,qty:parseFloat(r.qty)||1}),await k();else{const s=await c.create({...r,price:parseFloat(r.price)||0,qty:parseFloat(r.qty)||1});d([...o,s.data])}n({name:"",category:"Produce",price:"",qty:1,unit:"pcs",buyStatus:"NOW"}),w(null),y(!1),u(null)}catch(s){console.error("Failed to save item:",s)}},H=()=>{n({name:"",category:"Produce",price:"",qty:1,unit:"pcs",buyStatus:"NOW"}),w(null),y(!0),u(null)},M=t=>{n({name:t.name,category:t.category||"General",price:(t.price||0).toString(),qty:t.qty||1,unit:t.unit||"pcs",buyStatus:t.buyStatus||"NOW"}),w(t.id),y(!0),u(null)},q=async t=>{try{await c.delete(t),d(o.filter(s=>s.id!==t))}catch(s){console.error("Failed to delete item:",s)}},S=o.filter(t=>t.buyStatus==="NOW"),C=o.filter(t=>t.buyStatus==="LATER"),R=t=>B.filter(s=>t.some(l=>l.category===s)).concat([...new Set(t.map(s=>s.category))].filter(s=>!B.includes(s))),E=o.filter(t=>!t.isBought),K=E.reduce((t,s)=>t+s.price*s.qty,0),P=o.reduce((t,s)=>(t[s.category]=(t[s.category]||0)+s.price,t),{}),I=Object.keys(P).map(t=>({name:t,value:P[t]})),f=["#10B981","#3B82F6","#F59E0B","#EF4444","#8B5CF6"];return e.jsxs("div",{className:"space-y-6 relative",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Grocery List"}),e.jsx("button",{onClick:U,disabled:x,className:`p-2 rounded-lg bg-gray-100 text-gray-500 hover:text-primary transition-all ${x?"animate-spin cursor-not-allowed":""}`,title:"Refresh Intelligence",children:e.jsx(Q,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Smart shopping list synced with your Inventory and Recipes"})]}),e.jsxs("div",{className:"flex gap-3",children:[o.some(t=>t.isBought)&&e.jsx(e.Fragment,{children:e.jsx("button",{onClick:V,className:"text-red-500 bg-white border border-red-100 px-4 py-2.5 rounded-lg font-medium hover:bg-red-50 transition-colors",children:"Clear"})}),e.jsxs("button",{onClick:H,className:"bg-primary text-white px-5 py-2.5 rounded-lg font-medium shadow-sm hover:bg-emerald-600 transition-colors flex items-center justify-center",children:[e.jsx(X,{className:"w-5 h-5 mr-2"}),"Add Item"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:N?e.jsxs("div",{className:"bg-white rounded-xl p-20 flex flex-col items-center justify-center border border-gray-100 shadow-sm",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-gray-500 font-medium",children:"Loading your items..."})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-6",children:[e.jsxs("h2",{className:"text-sm font-black text-red-500 uppercase tracking-[0.2em] flex items-center gap-2 px-2",children:[e.jsx(ee,{className:"w-4 h-4 fill-current"})," Buy Now"]}),R(S).map(t=>e.jsx(_,{category:t,items:S,toggleItem:O,toggleBuyStatus:$,openEditModal:M,deleteItem:q},t)),S.length===0&&e.jsx("div",{className:"text-center p-10 bg-gray-50 rounded-xl border-2 border-dashed border-gray-100 text-gray-400 text-sm",children:"Everything is Buy Later or Stocked Up!"})]}),e.jsxs("div",{className:"flex-1 space-y-6",children:[e.jsxs("h2",{className:"text-sm font-black text-gray-400 uppercase tracking-[0.2em] flex items-center gap-2 px-2",children:[e.jsx(T,{className:"w-4 h-4"})," Buy Later"]}),R(C).map(t=>e.jsx(_,{category:t,items:C,toggleItem:O,toggleBuyStatus:$,openEditModal:M,deleteItem:q},t)),C.length===0&&e.jsx("div",{className:"text-center p-10 bg-gray-50 rounded-xl border-2 border-dashed border-gray-100 text-gray-400 text-sm",children:"No items in the long-term list."})]})]})})}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl p-6 text-white shadow-md",children:[e.jsx(T,{className:"w-10 h-10 mb-4 opacity-80"}),e.jsx("h3",{className:"text-xl font-bold",children:"Shopping Setup"}),e.jsxs("p",{className:"text-white/80 mt-2 text-sm leading-relaxed",children:["You have ",e.jsxs("span",{className:"font-bold text-white",children:[E.length," items"]})," remaining.",e.jsx("br",{}),"Estimated cost: ",e.jsxs("span",{className:"font-bold text-xl block mt-2",children:["$",K.toFixed(2)]})]}),e.jsxs("div",{className:"mt-6 flex flex-col gap-3",children:[o.some(t=>t.isBought)&&e.jsxs("button",{onClick:D,className:"w-full py-2.5 bg-emerald-500 hover:bg-emerald-400 text-white rounded-lg font-bold shadow-lg shadow-emerald-900/20 transition-all flex items-center justify-center group",children:[e.jsx(me,{className:"w-4 h-4 mr-2 group-hover:scale-110 transition-transform"}),"Shop & Save Now"]}),e.jsxs("button",{onClick:()=>F(!0),className:"w-full py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-semibold transition-colors flex items-center justify-center",children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"View Budget Analytics"]})]})]})})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-sm w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-bold text-lg",children:b?"Edit Grocery Item":"Add Grocery Item"}),e.jsx("button",{onClick:()=>y(!1),children:e.jsx(W,{className:"text-gray-400 hover:text-gray-600"})})]}),e.jsxs("form",{onSubmit:Z,className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[G&&e.jsx(te,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-primary animate-spin"}),e.jsx("input",{autoFocus:!0,type:"text",placeholder:"Item name (e.g. Bananas)",className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-100 rounded-xl focus:ring-4 focus:ring-primary/10 focus:border-primary outline-none transition-all font-bold",value:r.name,onChange:async t=>{const s=t.target.value;n({...r,name:s});const l=h.find(g=>g.name.toLowerCase()===s.toLowerCase());if(u(l?`You already have ${l.qty} in ${l.storageZone||l.location}. Still add this?`:null),s.length>2){A(!0);try{const g=await c.suggestCategory(s);g.data.category&&n(Y=>({...Y,category:g.data.category}))}catch{}A(!1)}}}),L&&e.jsxs("div",{className:"mt-2 flex items-start gap-2 p-2 bg-amber-50 border border-amber-100 rounded-lg text-[10px] text-amber-700 font-bold animate-head-shake",children:[e.jsx(se,{className:"w-3 h-3 flex-shrink-0"}),e.jsx("span",{children:L})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1 ml-1",children:"Quantity"}),e.jsxs("div",{className:"flex",children:[e.jsx("button",{type:"button",onClick:()=>n(t=>({...t,qty:Math.max(.5,t.qty-.5)})),className:"px-3 bg-gray-100 rounded-l-xl hover:bg-gray-200",children:"-"}),e.jsx("input",{type:"number",step:"0.5",className:"w-full px-2 py-2 border-y-2 border-gray-50 focus:outline-none text-center font-bold text-sm",value:r.qty,onChange:t=>n({...r,qty:parseFloat(t.target.value)||0})}),e.jsx("button",{type:"button",onClick:()=>n(t=>({...t,qty:t.qty+.5})),className:"px-3 bg-gray-100 rounded-r-xl hover:bg-gray-200",children:"+"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1 ml-1",children:"Unit"}),e.jsxs("select",{className:"w-full px-3 py-2 border-2 border-gray-100 rounded-xl bg-white outline-none text-sm font-bold",value:r.unit,onChange:t=>n({...r,unit:t.target.value}),children:[e.jsx("option",{value:"pcs",children:"pcs"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"ml",children:"ml"}),e.jsx("option",{value:"pack",children:"pack"})]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1 ml-1",children:"Category"}),e.jsx("select",{className:"w-full px-4 py-2 border-2 border-gray-100 rounded-xl bg-white focus:border-primary outline-none transition-all text-sm font-medium",value:r.category,onChange:t=>n({...r,category:t.target.value}),children:B.map(t=>e.jsx("option",{children:t},t))})]}),e.jsxs("div",{className:"w-24",children:[e.jsx("label",{className:"block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1 ml-1",children:"Price/Unit"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"0.00",className:"w-full px-4 py-2 border-2 border-gray-100 rounded-xl focus:border-primary outline-none text-sm font-medium",value:r.price,onChange:t=>n({...r,price:t.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1",children:"Shopping Logic"}),e.jsxs("div",{className:"flex gap-2 p-1 bg-gray-50 rounded-xl border-2 border-gray-100",children:[e.jsx("button",{type:"button",onClick:()=>n({...r,buyStatus:"NOW"}),className:`flex-1 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${r.buyStatus==="NOW"?"bg-red-500 text-white":"text-gray-400 hover:text-gray-600"}`,children:"Buy Now"}),e.jsx("button",{type:"button",onClick:()=>n({...r,buyStatus:"LATER"}),className:`flex-1 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${r.buyStatus==="LATER"?"bg-gray-500 text-white":"text-gray-400 hover:text-gray-600"}`,children:"Buy Later"})]})]}),e.jsx("button",{type:"submit",className:"w-full bg-primary text-white py-4 rounded-[1.5rem] font-black uppercase tracking-[0.2em] hover:bg-emerald-600 transition-all shadow-xl shadow-primary/20",children:b?"Save Changes":"Add to List"})]})]})}),z&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Spending Breakdown"}),e.jsx("button",{onClick:()=>F(!1),children:e.jsx(W,{className:"text-gray-400 hover:text-gray-600"})})]}),e.jsx("div",{className:"h-64 w-full",children:e.jsx(ae,{width:"100%",height:"100%",children:e.jsxs(re,{children:[e.jsx(le,{data:I,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",children:I.map((t,s)=>e.jsx(ne,{fill:f[s%f.length]},`cell-${s}`))}),e.jsx(oe,{formatter:t=>`$${t.toFixed(2)}`})]})})}),e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-2 text-sm",children:I.map((t,s)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:f[s%f.length]}}),e.jsx("span",{className:"text-gray-600 flex-1",children:t.name}),e.jsxs("span",{className:"font-medium",children:["$",t.value.toFixed(2)]})]},t.name))})]})})]})},_=({category:h,items:v,toggleItem:o,toggleBuyStatus:d,openEditModal:N,deleteItem:p})=>{const x=v.filter(a=>a.category===h);return x.length===0?null:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-3 bg-gray-50 border-b border-gray-100 flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-700",children:h}),e.jsxs("span",{className:"text-xs font-medium bg-gray-200 text-gray-600 px-2 py-0.5 rounded-full",children:[x.filter(a=>!a.isBought).length," items"]})]}),e.jsx("div",{className:"divide-y divide-gray-100",children:x.map(a=>e.jsxs("div",{className:`px-4 py-4 flex items-center justify-between group transition-colors ${a.isBought?"bg-gray-50/50":"hover:bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center cursor-pointer flex-1",onClick:()=>o(a.id),children:[e.jsx("div",{className:`w-6 h-6 rounded-full border-2 mr-3 flex items-center justify-center transition-colors ${a.isBought?"bg-primary border-primary":"border-gray-200"}`,children:a.isBought&&e.jsx(ie,{className:"w-3.5 h-3.5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`block truncate text-sm ${a.isBought?"text-gray-400 line-through":"text-gray-800 font-black"}`,children:a.name})}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-gray-400 font-bold uppercase tracking-tight",children:[e.jsxs("span",{children:[a.qty," ",a.unit]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["$",(a.price*a.qty).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:m=>{m.stopPropagation(),d(a.id)},className:`p-1.5 rounded-lg transition-all ${a.buyStatus==="NOW"?"text-red-500 hover:bg-red-50":"text-gray-200 hover:text-gray-400"}`,title:a.buyStatus==="NOW"?"Move to Buy Later":"Move to Buy Now",children:e.jsx(de,{className:`w-4 h-4 transition-transform ${a.buyStatus==="NOW"?"rotate-90":"-rotate-90"}`})}),e.jsx("button",{onClick:m=>{m.stopPropagation(),N(a)},className:"text-gray-300 hover:text-primary transition-all p-1.5",title:"Edit",children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>p(a.id),className:"text-gray-300 hover:text-red-500 transition-all p-1.5",title:"Delete",children:e.jsx(ce,{className:"w-4 h-4"})})]})]},a.id))})]})};export{je as default};
